{% extends 'core/base.html' %}

{% block title %}{{ action }} Entrada Financeira{% endblock %}

{% block extra_head %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
        font-family: 'Inter', sans-serif;
        background: #f8fafc;
    }
    
    .form-container {
        max-width: 570px;
        margin: 2rem auto;
        background: white;
        border-radius: 16px;
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        padding: 2.5rem;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }
    
    .dark .form-container {
        background: #1e293b;
        border-color: rgba(255, 255, 255, 0.1);
    }
    
    .form-title {
        font-size: 1.75rem;
        font-weight: 700;
        text-align: center;
        margin-bottom: 1.75rem;
        color: #1f2937;
        letter-spacing: -0.025em;
    }
    
    .dark .form-title {
        color: #f9fafb;
    }
    
    .form-label {
        font-size: 0.9375rem;
        font-weight: 500;
        color: #374151;
        margin-bottom: 0.5rem;
        display: block;
    }
    
    .dark .form-label {
        color: #e5e7eb;
    }
    
    .form-input {
        width: 100%;
        background: #f9fafb;
        border: 1.5px solid #e5e7eb;
        border-radius: 10px;
        padding: 0.75rem 1rem;
        font-size: 0.9375rem;
        color: #1f2937;
        transition: all 0.2s ease;
    }
    
    .dark .form-input {
        background: #334155;
        border-color: #475569;
        color: #f9fafb;
    }
    
    .form-input:focus {
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
        outline: none;
    }
    
    .form-input.invalid {
        border-color: #ef4444;
    }
    
    .form-input.valid {
        border-color: #10b981;
    }
    
    .form-error {
        color: #ef4444;
        font-size: 0.8125rem;
        margin-top: 0.25rem;
    }
    
    .dark .form-error {
        color: #fca5a5;
    }
    
    .form-group {
        margin-bottom: 1.25rem;
    }
    
    .form-row {
        display: flex;
        gap: 1rem;
    }
    
    .form-col {
        flex: 1;
    }
    
    .form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 1rem;
        margin-top: 1.75rem;
    }
    
    .form-button {
        background: #3b82f6;
        color: white;
        border: none;
        border-radius: 10px;
        padding: 0.75rem 1.75rem;
        font-weight: 500;
        font-size: 0.9375rem;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .form-button:hover {
        background: #2563eb;
        transform: translateY(-1px);
    }
    
    .cancel-button {
        background: white;
        color: #374151;
        border: 1.5px solid #e5e7eb;
        border-radius: 10px;
        padding: 0.75rem 1.75rem;
        font-weight: 500;
        font-size: 0.9375rem;
        cursor: pointer;
        transition: all 0.2s ease;
        text-decoration: none;
        text-align: center;
    }
    
    .dark .cancel-button {
        background: #1e293b;
        color: #e5e7eb;
        border-color: #475569;
    }
    
    .cancel-button:hover {
        background: #f3f4f6;
        transform: translateY(-1px);
    }
    
    .dark .cancel-button:hover {
        background: #334155;
    }
    
    .currency-symbol {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: #6b7280;
        pointer-events: none;
    }
    
    .dark .currency-symbol {
        color: #9ca3af;
    }
    
    .input-wrapper {
        position: relative;
    }
    
    @media (max-width: 640px) {
        .form-container {
            padding: 1.5rem;
        }
        
        .form-row {
            flex-direction: column;
            gap: 1.25rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="form-container">
    <h1 class="form-title">{{ action }} Entrada Financeira</h1>

    <form method="post" novalidate>
        {% csrf_token %}

        {% if form.non_field_errors %}
            <div class="form-group bg-red-50 border-l-4 border-red-500 p-4 dark:bg-red-900/20 dark:border-red-700">
                <div class="flex items-start">
                    <svg class="h-5 w-5 text-red-500 dark:text-red-400 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                    </svg>
                    <div class="ml-3">
                        <p class="text-sm text-red-700 dark:text-red-300">
                            {{ form.non_field_errors }}
                        </p>
                    </div>
                </div>
            </div>
        {% endif %}

        <div class="form-group">
            <label for="{{ form.nome.id_for_label }}" class="form-label">
                Descrição <span class="text-red-500">*</span>
            </label>
            {{ form.nome }}
            {% if form.nome.errors %}
                <p class="form-error">{{ form.nome.errors.as_text }}</p>
            {% endif %}
        </div>

        <div class="form-row">
            <div class="form-col">
            <div class="form-group">
                <label for="{{ form.valor.id_for_label }}" class="form-label">
                    Valor <span class="text-red-500">*</span>
                </label>
                <div class="input-wrapper">
                    <span class="currency-symbol">R$</span>
                    <input type="text" 
                        id="{{ form.valor.id_for_label }}" 
                        name="{{ form.valor.html_name }}"
                        class="form-input" 
                        required
                        pattern="^\d{1,3}(\.\d{3})*,\d{2}$"
                        placeholder="0,00">
                </div>
                {% if form.valor.errors %}
                    <p class="form-error">{{ form.valor.errors.as_text }}</p>
                {% endif %}
            </div>
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const valorInput = document.getElementById('{{ form.valor.id_for_label }}');
                    
                    if (valorInput) {
                        // Configuração inicial
                        valorInput.style.paddingLeft = '2.5rem';
                        
                        // Formatação em tempo real
                        valorInput.addEventListener('input', function(e) {
                            let value = e.target.value.replace(/\D/g, '');
                            
                            // Converte para centavos
                            value = (value / 100).toFixed(2);
                            
                            // Formata como moeda brasileira
                            value = parseFloat(value).toLocaleString('pt-BR', {
                                minimumFractionDigits: 2,
                                maximumFractionDigits: 2
                            });
                            
                            e.target.value = value;
                            
                            // Validação visual
                            if (e.target.checkValidity()) {
                                e.target.classList.add('valid');
                                e.target.classList.remove('invalid');
                            } else {
                                e.target.classList.add('invalid');
                                e.target.classList.remove('valid');
                            }
                        });
                        
                        // Dispara o evento input para formatação inicial se houver valor
                        if (valorInput.value) {
                            valorInput.dispatchEvent(new Event('input'));
                        }
                        
                        // Validação ao submeter o formulário
                        const form = valorInput.closest('form');
                        if (form) {
                            form.addEventListener('submit', function(e) {
                                // Remove formatação antes de enviar
                                valorInput.value = valorInput.value.replace(/[^\d,]/g, '')
                                                                .replace(',', '.');
                            });
                        }
                    }
                });
            </script>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label for="{{ form.data.id_for_label }}" class="form-label">
                        Data <span class="text-red-500">*</span>
                    </label>
                    {{ form.data }}
                    {% if form.data.errors %}
                        <p class="form-error">{{ form.data.errors.as_text }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="form-row">
            <div class="form-col">
                <div class="form-group">
                    <label for="{{ form.local.id_for_label }}" class="form-label">
                        Origem <span class="text-red-500">*</span>
                    </label>
                    {{ form.local }}
                    {% if form.local.errors %}
                        <p class="form-error">{{ form.local.errors.as_text }}</p>
                    {% endif %}
                </div>
            </div>
            <div class="form-col">
                <div class="form-group">
                    <label for="{{ form.forma_recebimento.id_for_label }}" class="form-label">
                        Forma de Recebimento <span class="text-red-500">*</span>
                    </label>
                    {{ form.forma_recebimento }}
                    {% if form.forma_recebimento.errors %}
                        <p class="form-error">{{ form.forma_recebimento.errors.as_text }}</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="form-group">
            <label for="{{ form.conta_bancaria.id_for_label }}" class="form-label">
                Conta Bancária <span class="text-red-500">*</span>
            </label>
            {{ form.conta_bancaria }}
            {% if form.conta_bancaria.errors %}
                <p class="form-error">{{ form.conta_bancaria.errors.as_text }}</p>
            {% endif %}
        </div>

        <div class="form-group">
            <label for="{{ form.observacao.id_for_label }}" class="form-label">
                Observações
            </label>
            {{ form.observacao }}
            {% if form.observacao.errors %}
                <p class="form-error">{{ form.observacao.errors.as_text }}</p>
            {% endif %}
        </div>

        <div class="form-actions">
            <a href="{% url 'core:entrada_list' %}" class="cancel-button">
                Cancelar
            </a>
            <button type="submit" class="form-button">
                {{ action }} Entrada
            </button>
        </div>
    </form>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Adiciona classes estilizadas aos campos do formulário
        document.querySelectorAll('input, select, textarea').forEach(el => {
            el.classList.add('form-input');
        });

        // Ajuste para o campo de valor
        const valorInput = document.getElementById('{{ form.valor.id_for_label }}');
        if (valorInput) {
            valorInput.style.paddingLeft = '2.5rem';
        }

        // Validação em tempo real
        document.querySelectorAll('input[required], select[required]').forEach(el => {
            el.addEventListener('input', function() {
                if (this.checkValidity()) {
                    this.classList.add('valid');
                    this.classList.remove('invalid');
                } else {
                    this.classList.add('invalid');
                    this.classList.remove('valid');
                }
            });
        });

        // Limitar datas futuras
        const dataInput = document.getElementById('{{ form.data.id_for_label }}');
        if (dataInput) {
            const today = new Date().toISOString().split('T')[0];
            dataInput.setAttribute('max', today);
        }

        // Inicializa a validação dos campos obrigatórios
        document.querySelectorAll('input[required], select[required]').forEach(el => {
            el.dispatchEvent(new Event('input'));
        });
    });
</script>
{% endblock %}